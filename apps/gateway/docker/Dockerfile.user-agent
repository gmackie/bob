FROM node:22-bookworm

RUN apt-get update && apt-get install -y \
    git \
    curl \
    wget \
    openssh-client \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /home/node

RUN npm install -g \
    node-pty \
    ws \
    tsx

COPY agent-server.ts /home/node/agent-server.ts

ENV HOME=/home/node
ENV USER=node

EXPOSE 3100

USER node

CMD ["npx", "tsx", "/home/node/agent-server.ts"]
